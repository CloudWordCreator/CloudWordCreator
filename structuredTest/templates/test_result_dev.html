<!DOCTYPE html>
<html lang="ja">
<head>
    {% load static %}
    <link href="{% static 'css/style.css' %}" media="print" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="{% static 'structuredTest/css/test_result_style.css' %}">
    <script src="{% static 'structuredTest/js/test_result_scripts.js' %}"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>テスト</title>
</head>
<body>
    <button id="english-to-japanese-button" class="button">英語→日本語</button>
    <button id="japanese-to-english-button" class="button">日本語→英語</button>
    <button onclick="printContent()" class="button">印刷</button>
    <a href="{% url 'display_data' %}">戻る</a>
    <div class="print-area">
        <div id="english-to-japanese-content" class="tab">
            <!-- 動的に生成された英語→日本語の問題がここに表示される -->
            <div id="english-to-japanese-questions"></div>
        </div>
        <div id="japanese-to-english-content" class="tab" style="display: none;">
            <!-- 動的に生成された日本語→英語の問題がここに表示される -->
            <div id="japanese-to-english-questions"></div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // ビュー関数で返された JSON データ (Django テンプレート変数として埋め込む)
            const data = {{ data|safe }};
            console.log(data);

            // 英語→日本語の問題を表示
            const englishToJapaneseContainer = document.getElementById('english-to-japanese-questions');
            data.units.forEach(unit => {
                const unitTitle = document.createElement('h3');
                unitTitle.textContent = unit.name;
                englishToJapaneseContainer.appendChild(unitTitle);

                unit.sub_units.forEach(subUnit => {
                    const subUnitTitle = document.createElement('h4');
                    subUnitTitle.textContent = subUnit.name;
                    englishToJapaneseContainer.appendChild(subUnitTitle);

                    const table = document.createElement('table');
                    table.classList.add('table', 'table-bordered');

                    const thead = document.createElement('thead');
                    thead.innerHTML = `
                        <tr>
                            <th>英語</th>
                            <th>日本語</th>
                        </tr>`;
                    table.appendChild(thead);

                    const tbody = document.createElement('tbody');
                    subUnit.words.forEach(word => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${word.english}</td>
                            <td>${word.japanese}</td>
                        `;
                        tbody.appendChild(row);
                    });
                    table.appendChild(tbody);
                    englishToJapaneseContainer.appendChild(table);
                });
            });

            // 日本語→英語の問題を表示 (必要に応じて追加)
            const japaneseToEnglishContainer = document.getElementById('japanese-to-english-questions');
            data.units.forEach(unit => {
                const unitTitle = document.createElement('h3');
                unitTitle.textContent = unit.name;
                japaneseToEnglishContainer.appendChild(unitTitle);

                unit.sub_units.forEach(subUnit => {
                    const subUnitTitle = document.createElement('h4');
                    subUnitTitle.textContent = subUnit.name;
                    japaneseToEnglishContainer.appendChild(subUnitTitle);

                    const list = document.createElement('ul');
                    subUnit.words.forEach(word => {
                        const listItem = document.createElement('li');
                        listItem.textContent = `${word.japanese} → ${word.english}`;
                        list.appendChild(listItem);
                    });
                    japaneseToEnglishContainer.appendChild(list);
                });
            });

            // タブ切り替え機能
            document.getElementById('english-to-japanese-button').onclick = () => {
                document.getElementById('english-to-japanese-content').style.display = 'block';
                document.getElementById('japanese-to-english-content').style.display = 'none';
            };
            document.getElementById('japanese-to-english-button').onclick = () => {
                document.getElementById('english-to-japanese-content').style.display = 'none';
                document.getElementById('japanese-to-english-content').style.display = 'block';
            };
        });
    </script>
</body>
</html>